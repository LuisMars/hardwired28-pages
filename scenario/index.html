<!DOCTYPE html>
<html lang="en" data-theme="corporate">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hardwired 28 - Scenario Generator</title>
    <script>document.documentElement.dataset.theme = 'corporate';</script>
    <meta property="og:title" content="Hardwired 28 - Scenario Generator">
    <meta property="og:description" content="Corporate cablepunk skirmish wargame">
    <meta property="og:image" content="http://hardwired28.luismars.com/img/social.png">
    <meta property="og:url" content="http://hardwired28.luismars.com/scenario/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="stylesheet" href="../style-base.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; }
        code {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            background-color: #f0f0f0;
            padding: 1px 3px;
            border-radius: 2px;
        }
        .loading { display: flex; justify-content: center; align-items: center; height: 100vh; background: #F1F5F9; color: #1E293B; font-size: 1.5rem; }
        [data-theme="zorn"] .loading { background: #1a1a2e; color: #fff; }
        [data-theme="hallucination"] .loading { background: #212121; color: #fff; }
    </style>
</head>
<body class="has-app-menu">
    <nav class="app-menu" data-theme="corporate" data-open="false" aria-label="Navigation">
        <div class="app-menu__inner">
            <a class="app-menu__brand" href="../">Hardwired 28</a>
            <button class="app-menu__toggle" type="button" onclick="toggleMenu()" aria-label="Menu"></button>
            <div class="app-menu__links">
                <a href="../rulebook">Rulebook</a>
                <a href="../print">Print</a>
                <a href="../quick-reference">Quick Reference</a>
                <a href="../builder/">Squad Builder</a>
                <a href="./" class="current">Scenarios</a>
                <a href="../es/scenario/">Castellano</a>
            </div>
        </div>
    </nav>
    <div id="root"><div class="loading">Loading Scenario Generator...</div></div>
    <script>
        function toggleMenu() {
            const nav = document.querySelector('.app-menu');
            if (!nav) return;
            nav.dataset.open = nav.dataset.open === 'true' ? 'false' : 'true';
        }
    </script>

    <script>
        window.SCENARIO_DATA = null;
        window.LOCALE = 'en';

        const fetchJson = url => fetch(url).then(r => r.ok ? r.json() : null).catch(() => null);

        const dataPrefix = '../data';

        Promise.all([
            // Mission tables
            fetchJson(`${dataPrefix}/missions/mission_table.json`),
            fetchJson(`${dataPrefix}/missions/mission_descriptions.json`),
            fetchJson(`${dataPrefix}/missions/deployment.json`),
            fetchJson(`${dataPrefix}/missions/coworker_setup.json`),
            fetchJson(`${dataPrefix}/missions/coworker_modifiers.json`),
            fetchJson(`${dataPrefix}/missions/hostile_timing.json`),
            fetchJson(`${dataPrefix}/missions/hostile_factions.json`),
            fetchJson(`${dataPrefix}/missions/loot_layout.json`),
            fetchJson(`${dataPrefix}/missions/loot_modifiers.json`),
            fetchJson(`${dataPrefix}/missions/spawn_location.json`),
            // Campaign advantage tables
            fetchJson(`${dataPrefix}/campaign/evidence_gap.json`),
            fetchJson(`${dataPrefix}/campaign/setup_advantages.json`),
            fetchJson(`${dataPrefix}/campaign/tactical_advantages.json`),
            // Hostile faction data + coworkers
            fetchJson(`${dataPrefix}/hostiles/scrapers.json`),
            fetchJson(`${dataPrefix}/hostiles/feral_crews.json`),
            fetchJson(`${dataPrefix}/hostiles/wave_callers.json`),
            fetchJson(`${dataPrefix}/hostiles/static_wraiths.json`),
            fetchJson(`${dataPrefix}/hostiles/feral_automata.json`),
            fetchJson(`${dataPrefix}/hostiles/cable_feeders.json`),
            fetchJson(`${dataPrefix}/hostiles/coworkers.json`),
            // Lore templates
            fetchJson(`${dataPrefix}/lore/mission_lore.json`),
        ])
        .then(([
            missionTable, missionDescriptions,
            deployment, coworkerSetup, coworkerModifiers,
            hostileTiming, hostileFactions, lootLayout, lootModifiers, spawnLocation,
            evidenceGap, setupAdvantages, tacticalAdvantages,
            scrapers, feralCrews, waveCallers, staticWraiths, feralAutomata, cableFeeders, coworkers,
            loreData,
        ]) => {
            const factionData = {
                'hostiles/scrapers.json': scrapers,
                'hostiles/feral_crews.json': feralCrews,
                'hostiles/wave_callers.json': waveCallers,
                'hostiles/static_wraiths.json': staticWraiths,
                'hostiles/feral_automata.json': feralAutomata,
                'hostiles/cable_feeders.json': cableFeeders,
            };
            // Attach pre-built descriptions to mission table items
            (missionTable?.items || []).forEach(item => {
                if (item.file && missionDescriptions?.[item.file]) {
                    item.description = missionDescriptions[item.file];
                }
            });
            window.SCENARIO_DATA = {
                missionTable, deployment, coworkerSetup, coworkerModifiers,
                hostileTiming, hostileFactions, lootLayout, lootModifiers, spawnLocation,
                evidenceGap, setupAdvantages, tacticalAdvantages,
                factionData, coworkers, loreData,
            };
        })
        .then(() => {
            const cacheBust = '?v=' + Date.now();
            return fetch('../scenario-generator.jsx' + cacheBust)
                .then(r => r.text())
                .then(code => {
                    const transformed = Babel.transform(code, { presets: ['react'] }).code;
                    const script = document.createElement('script');
                    script.textContent = transformed;
                    document.body.appendChild(script);
                });
        })
        .catch(err => {
            document.getElementById('root').innerHTML =
                '<div class="loading" style="flex-direction:column;"><div>Error loading scenario generator</div><div style="font-size:0.8rem;margin-top:1rem;">' + err.message + '</div></div>';
            console.error(err);
        });
    </script>
</body>
</html>
